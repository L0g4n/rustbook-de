<!DOCTYPE HTML>
<html lang="de" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Testen | Die Programmiersprache Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../book/Bedingte_Kompilierung.html" />
    
    
    <link rel="prev" href="../book/Der_Stack_Und_Der_Heap.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.2" data-chapter-title="Testen" data-filepath="book/Testen.md" data-basepath=".." data-revision="Mon Nov 02 2015 23:26:18 GMT+0100 (CET)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Einführung
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="book/Erste_Schritte.html">
            
                
                    <a href="../book/Erste_Schritte.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Erste Schritte
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="book/Rust_Installieren.html">
            
                
                    <a href="../book/Rust_Installieren.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Rust installieren
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="book/Hallo_Welt.html">
            
                
                    <a href="../book/Hallo_Welt.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Hallo Welt
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="book/Hallo_Cargo.html">
            
                
                    <a href="../book/Hallo_Cargo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Hallo Cargo
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="book/Lerne_Rust.html">
            
                
                    <a href="../book/Lerne_Rust.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Lerne Rust
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="book/Ratespiel.html">
            
                
                    <a href="../book/Ratespiel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Ratespiel
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="book/Speisende_Philosophen.html">
            
            <span><b>2.2.</b> Speisende Philosophen</span>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="book/Rust_In_Anderen_Sprachen.html">
            
            <span><b>2.3.</b> Rust in anderen Sprachen</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="book/Effektives_Rust.html">
            
                
                    <a href="../book/Effektives_Rust.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Effektives Rust
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="book/Der_Stack_Und_Der_Heap.html">
            
                
                    <a href="../book/Der_Stack_Und_Der_Heap.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Der Stack und der Heap
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.2" data-path="book/Testen.html">
            
                
                    <a href="../book/Testen.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Testen
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="book/Bedingte_Kompilierung.html">
            
                
                    <a href="../book/Bedingte_Kompilierung.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Bedingte Kompilierung
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="book/Dokumentation.html">
            
                
                    <a href="../book/Dokumentation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Dokumentation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="book/Iteratoren.html">
            
                
                    <a href="../book/Iteratoren.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Iteratoren
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="book/Nebenläufigkeit.html">
            
                
                    <a href="../book/Nebenläufigkeit.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Nebenläufigkeit
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="book/Fehlerbehandlung.html">
            
            <span><b>3.7.</b> Fehlerbehandlung</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="book/Garantien_Wählen.html">
            
            <span><b>3.8.</b> Garantien Wählen</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="book/FFI.html">
            
            <span><b>3.9.</b> FFI</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="book/Borrow_Und_AsRef.html">
            
            <span><b>3.10.</b> Borrow und AsRef</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="book/Release_Kanäle.html">
            
            <span><b>3.11.</b> Release Kanäle</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="book/Syntax_Und_Semantik.html">
            
                
                    <a href="../book/Syntax_Und_Semantik.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Syntax und Semantik
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="book/Variablenbindung.html">
            
                
                    <a href="../book/Variablenbindung.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Variablenbindung
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="book/Funktionen.html">
            
                
                    <a href="../book/Funktionen.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Funktionen
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="book/Primitive_Typen.html">
            
                
                    <a href="../book/Primitive_Typen.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Primitive Typen
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="book/Kommentare.html">
            
                
                    <a href="../book/Kommentare.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Kommentare
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="book/If.html">
            
                
                    <a href="../book/If.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        if
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="book/Schleifen.html">
            
                
                    <a href="../book/Schleifen.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Schleifen
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="book/Besitz.html">
            
                
                    <a href="../book/Besitz.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        Besitz
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="book/Referenzen_Und_Ausleihen.html">
            
                
                    <a href="../book/Referenzen_Und_Ausleihen.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        Referenzen und Ausleihen
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="book/Lebensdauer.html">
            
                
                    <a href="../book/Lebensdauer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        Lebensdauer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="book/Veränderbarkeit.html">
            
            <span><b>4.10.</b> Veränderbarkeit</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="book/Structs.html">
            
                
                    <a href="../book/Structs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.11.</b>
                        
                        Structs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="book/Enums.html">
            
            <span><b>4.12.</b> Enums</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="book/Match.html">
            
            <span><b>4.13.</b> Match</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="book/Muster.html">
            
            <span><b>4.14.</b> Muster</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.15" data-path="book/Methodensyntax.html">
            
            <span><b>4.15.</b> Methodensyntax</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.16" data-path="book/Vektoren.html">
            
            <span><b>4.16.</b> Vektoren</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.17" data-path="book/Strings.html">
            
            <span><b>4.17.</b> Strings</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.18" data-path="book/Generics.html">
            
            <span><b>4.18.</b> Generics</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.19" data-path="book/Traits.html">
            
            <span><b>4.19.</b> Traits</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.20" data-path="book/Drop.html">
            
            <span><b>4.20.</b> Drop</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.21" data-path="book/If_Let.html">
            
            <span><b>4.21.</b> if let</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.22" data-path="book/Trait_Objekte.html">
            
            <span><b>4.22.</b> Trait Objekte</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.23" data-path="book/Closures.html">
            
            <span><b>4.23.</b> Closures</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.24" data-path="book/UFCS.html">
            
            <span><b>4.24.</b> Universal Function Call Syntax</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.25" data-path="book/Crates_Und_Module.html">
            
            <span><b>4.25.</b> Crates und Module</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.26" data-path="book/Const_Und_Static.html">
            
            <span><b>4.26.</b> `const` und `static`</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.27" data-path="book/Attribute.html">
            
            <span><b>4.27.</b> Attribute</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.28" data-path="book/Type_Aliase.html">
            
            <span><b>4.28.</b> `type` Aliase</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.29" data-path="book/Zwischen_Typen_Umwandeln.html">
            
            <span><b>4.29.</b> Zwischen typen umwandeln</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.30" data-path="book/Assoziierte_Typen.html">
            
            <span><b>4.30.</b> Assoziierte Typen</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.31" data-path="book/Größenlose_Typen.html">
            
            <span><b>4.31.</b> Größenlose Typen</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.32" data-path="book/Operatoren_Und_Überladen.html">
            
            <span><b>4.32.</b> Operatoren und Überladen</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.33" data-path="book/Deref_Umwandlung.html">
            
            <span><b>4.33.</b> Deref Umwandlung</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.34" data-path="book/Makros.html">
            
            <span><b>4.34.</b> Makros</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.35" data-path="book/Raw_Zeiger.html">
            
            <span><b>4.35.</b> Raw Zeiger</span>
            
            
        </li>
    
        <li class="chapter " data-level="4.36" data-path="book/Unsafe.html">
            
            <span><b>4.36.</b> `unsafe`</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="book/Nightly_Rust.html">
            
            <span><b>5.</b> Nightly Rust</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="book/Compiler_Plugins.html">
            
            <span><b>5.1.</b> Compiler Plugins</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="book/Inline_Assembly.html">
            
            <span><b>5.2.</b> Inline Assembly</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="book/No_Stdlib.html">
            
            <span><b>5.3.</b> `no_stdlib`</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="book/Intrinsics.html">
            
            <span><b>5.4.</b> Intrinsics</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="book/Lang_Items.html">
            
            <span><b>5.5.</b> Lang items</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="book/Fortgeschrittenes_Linken.html">
            
            <span><b>5.6.</b> Fortgeschrittenes Linken</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="book/Benchmark_Tests.html">
            
            <span><b>5.7.</b> Benchmark Tests</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="book/Box_Syntax_Und_Muster.html">
            
            <span><b>5.8.</b> Box Syntax und Muster</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="book/Slice_Muster.html">
            
            <span><b>5.9.</b> Slice Muster</span>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="book/Assoziierte_Konstanten.html">
            
            <span><b>5.10.</b> Assoziierte Konstanten</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="book/Glossar.html">
            
            <span><b>6.</b> Glossar</span>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="book/Akademische_Forschung.html">
            
            <span><b>7.</b> Akademische Forschung</span>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Veröffentlicht mit GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Die Programmiersprache Rust</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="testing"><a name="testing" class="plugin-anchor" href="#testing"><span class="fa fa-link"></span></a>Testing</h1>
<blockquote>
<p>Program testing can be a very effective way to show the presence of bugs, but
it is hopelessly inadequate for showing their absence.</p>
<p><em>Das Testen von Programmen ist eine sehr effektive Art,
die Anwesenheit von Bugs zu zeigen, aber ist hoffnungslos unangemessen, deren Abwesenheit zu zeigen.</em></p>
<p>Edsger W. Dijkstra, &quot;The Humble Programmer&quot; (1972)</p>
</blockquote>
<h2 id="das-test-attribut"><a name="das-test-attribut" class="plugin-anchor" href="#das-test-attribut"><span class="fa fa-link"></span></a>Das <code>test</code> Attribut</h2>
<p>In Rust ist ein Test ganz einfach eine Funktion die mit <code>test</code> annotiert ist.
Beginnen wir also ein kleines Cargo Projekt namens <code>adder</code>:</p>
<pre><code class="lang-bash">$ cargo new adder
$ <span class="hljs-built_in">cd</span> adder
</code></pre>
<p>Wenn wir <code>cargo new</code> ohne <code>--bin</code> ausf&#xFC;hren erzeugt Cargo ein Library-Projekt.
Cargo generiert automatisch einen kleinen Test, wie man am Inhalt von <code>src/lib.rs</code> sieht:</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
}
</code></pre>
<p>Achte auf <code>#[test]</code>.
Das ist ein Attribut und es markiert die Funktion <code>it_works()</code> als Test.
Sie ist erst mal leer.
Dann kann sie auch auch nicht fehlschlagen.
Wir k&#xF6;nnen sie ganz einfach mit <code>cargo test</code> ausf&#xFC;hren:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Hier sehen wir zwei Ausgaben.
Die erste f&#xFC;r den Test den wir geschrieben haben,
die zweite f&#xFC;r Dokumentationstests, davon sp&#xE4;ter mehr.
Vorerst:</p>
<pre><code class="lang-text">test it_works ... ok
</code></pre>
<p>Beachte dass hier der Name unserer Funktion <code>it_works</code> steht.</p>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
}
</code></pre>
<p>Warum schl&#xE4;gt dieser leere Test aber nun nicht fehl?
Jeder Test der kein <code>panic!()</code> provoziert ist erfolgreich.
Wie k&#xF6;nnten wir ihn nun fehlschlagen lassen?</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert!</span>(<span class="hljs-keyword">false</span>);
}
</code></pre>
<p><code>assert!</code> ist ein Macro in Rust das genau ein Argument nimmt,
und wenn das nicht <code>true</code> ist, dann ruft es <code>panic!</code> auf.
Also nochmal:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... FAILED

failures:

---- it_works stdout ----
        thread <span class="hljs-string">&apos;it_works&apos;</span> panicked at <span class="hljs-string">&apos;assertion failed: false&apos;</span>, /home/steve/tmp/adder/src/lib.rs:<span class="hljs-number">3</span>



failures:
    it_works

<span class="hljs-built_in">test</span> result: FAILED. <span class="hljs-number">0</span> passed; <span class="hljs-number">1</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

thread <span class="hljs-string">&apos;&lt;main&gt;&apos;</span> panicked at <span class="hljs-string">&apos;Some tests failed&apos;</span>, /home/steve/src/rust/src/libtest/lib.rs:<span class="hljs-number">247</span>
</code></pre>
<p>Rust sagt uns, dass unser Test gefailt ist.</p>
<pre><code class="lang-text">test it_works ... FAILED
</code></pre>
<p>Was uns auch die Zusammenfassung am Ende sagt:</p>
<pre><code class="lang-text">test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured
</code></pre>
<p>Wir haben ebenfalls einen non-zero status code bekommen, ein feature unserer Shell (<em>linux und OS X</em>), dass das letzte Kommando fehlgeschlagen ist.</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">echo</span> $?
<span class="hljs-number">101</span>
</code></pre>
<p>Auf Windows in <code>cmd</code> :</p>
<pre><code class="lang-bash">&gt; <span class="hljs-built_in">echo</span> %ERRORLEVEL%
</code></pre>
<p>oder PowerShell:</p>
<pre><code class="lang-bash">&gt; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$LASTEXITCODE</span> <span class="hljs-comment"># Der Exitcode selbst</span>
&gt; <span class="hljs-built_in">echo</span> $? <span class="hljs-comment"># ein boolean, Erfolgreich oder nicht</span>
</code></pre>
<p>Das ist n&#xFC;tzlich wenn du <code>cargo test</code> in andere Tools integrieren willst.</p>
<p>Wir k&#xF6;nnen den Test auch invertieren, wenn wir wollen, dass er fehlschl&#xE4;gt: <code>should_panic</code>:</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-preprocessor">#[should_panic]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert!</span>(<span class="hljs-keyword">false</span>);
}
</code></pre>
<p>Der Test z&#xE4;hlt nun als erfolgreich, wenn <code>panic!</code> eintritt.
Gleich mal ausprobieren:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Rust kennt noch ein weiteres Macro: <code>assert_eq!</code>, zum Vergleichen zweier Werte:</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-preprocessor">#[should_panic]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);
}
</code></pre>
<p>Schl&#xE4;gt das hier nun fehl?
Nein, denn da steht noch <code>should_panic</code>:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p><code>should_panic</code> ist immer mit etwas Vorsicht zu genie&#xDF;en, denn es schwer sicher zu sein, ob der Test nicht auf Grund anderer Probleme ge<code>panic</code>t hat.
Wir k&#xF6;nnen aber Bedingungen f&#xFC;r bestimmte Fehler hinzuf&#xFC;gen:</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-preprocessor">#[should_panic(expected = &quot;assertion failed&quot;)]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);
}
</code></pre>
<p>Jetzt muss das <code>assert_eq!</code> fehlschlagen, sonst scheitert der Test trotzdem.</p>
<p>Soviel also zu Grundlagen, schreiben wir endlich einen n&#xFC;tzlichen Test!</p>
<pre><code class="lang-rust"><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add_two</span></span>(a: <span class="hljs-keyword">i32</span>) -&gt; <span class="hljs-keyword">i32</span> {
    a + <span class="hljs-number">2</span>
}

<span class="hljs-preprocessor">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">4</span>, add_two(<span class="hljs-number">2</span>));
}
</code></pre>
<p>Das ist ein klassischer Fall f&#xFC;r <code>assert_eq!</code>: Wir rufen eine Funktion auf und vergleichen ihren R&#xFC;ckgabewert.</p>
<h2 id="das-ignore-attribut"><a name="das-ignore-attribut" class="plugin-anchor" href="#das-ignore-attribut"><span class="fa fa-link"></span></a>Das <code>ignore</code> Attribut</h2>
<p>In Manchen Situationen wollen wir bestimmte Tests nicht immer mit ausf&#xFC;hren, besonders, wenn sie teuer sind.
Diese kann man dann mit <code>ignore</code> ausschalten:</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">4</span>, add_two(<span class="hljs-number">2</span>));
}

<span class="hljs-preprocessor">#[test]</span>
<span class="hljs-preprocessor">#[ignore]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">expensive_test</span></span>() {
    <span class="hljs-comment">// Code der eine Stunde l&#xE4;uft</span>
}
</code></pre>
<p>Jetzt werden sie exklusiv dann ausgef&#xFC;hrt wenn wir <code>cargo test -- --ignored</code> ausf&#xFC;hren:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">2</span> tests
<span class="hljs-built_in">test</span> expensive_<span class="hljs-built_in">test</span> ... ignored
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">1</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Wir sehen: <code>it_works</code> wurde getestet, <code>expensive_test</code> nicht.</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span> -- --ignored
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> expensive_<span class="hljs-built_in">test</span> ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Wichtig: <code>--ignored</code> ist ein Argument, das von dem Testbinary interpretiert wird, nicht von Cargo selbst.
Das wird mit den extra <code>--</code> vermittelt.</p>
<h2 id="das-tests-modul"><a name="das-tests-modul" class="plugin-anchor" href="#das-tests-modul"><span class="fa fa-link"></span></a>Das <code>tests</code> Modul</h2>
<p>Was ist allerdings, wenn wir noch Hilfsfunktionen f&#xFC;r unsere Tests brauchen,
die selbst keine Tests sind, die wir aber auch nicht mit ausliefern wollen?
Daf&#xFC;r kann man Tests innerhalb eines <code>tests</code> Moduls implementieren.
So in etwa:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add_two</span></span>(a: <span class="hljs-keyword">i32</span>) -&gt; <span class="hljs-keyword">i32</span> {
    a + <span class="hljs-number">2</span>
}

<span class="hljs-preprocessor">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> tests {
    <span class="hljs-keyword">use</span> super::add_two;

    <span class="hljs-preprocessor">#[test]</span>
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
        <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">4</span>, add_two(<span class="hljs-number">2</span>));
    }
}
</code></pre>
<p>Das erlaubt es uns alle unsere Tests hier zu gruppieren und zus&#xE4;tzlich auch noch ggf. Hilfsfunktionen zu implementieren.
Dieses gesamte Modul wird nicht in unser crate kompiliert, wenn wir es nicht explizit als Test kompilieren, wir haben also nie Testcode in unserer Bibliothek.
Das spart nicht nur Kompilierzeit, sondern auch noch Platz.</p>
<p>Eine weitere &#xC4;nderung ist die <code>use</code> Deklaration.
Weil wir uns hier in einem Untermodul und damit einem anderen Namespace befinden m&#xFC;ssen, m&#xFC;ssen wir die zu testende Funktion quasi importieren.
Das kann nerven, wenn wir irgendwann gr&#xF6;&#xDF;ere Projekte haben, also vereinfachen wir das doch einfach mit <code>*</code></p>
<pre><code class="lang-rust,ignore">pub fn add_two(a: i32) -&gt; i32 {
    a + 2
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        assert_eq!(4, add_two(2));
    }
}
</code></pre>
<p>Beachte, dass sich die <code>use</code> Zeile ge&#xE4;ndert hat:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
    Updating registry `https://github.com/rust-lang/crates.io-index`
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> tests::it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Sch&#xF6;n!</p>
<p>Die momentane Konvention ist, dass das <code>tests</code> Modul deine &quot;unit-style&quot; tests enth&#xE4;lt.
Alles was nur kleine Funktionalit&#xE4;tstests umfasst.
Integrationstest jedoch, verdienen etwas mehr platz, daf&#xFC;r haben wir das <code>tests</code> Verzeichnis.</p>
<h2 id="das-tests-verzeichnis"><a name="das-tests-verzeichnis" class="plugin-anchor" href="#das-tests-verzeichnis"><span class="fa fa-link"></span></a>Das <code>tests</code> Verzeichnis</h2>
<p>Um einen Integrationstest zu schreiben erzeugen wir erst einmal unser <code>tests</code> Verzeichnis und legen darin eine <code>.rs</code> Datei an: <code>tests/lib.rs</code>:</p>
<pre><code class="lang-rust,ignore">extern crate adder;

#[test]
fn it_works() {
    assert_eq!(4, adder::add_two(2));
}
</code></pre>
<p>Das sieht unserem vorherigen Test schon sehr &#xE4;hnlich, naja, nicht ganz.
Wir haben nun die Zeile <code>extern crate adder</code> ganz oben.
Das ist weil die Tests im <code>tests</code> Verzeichnis ein eigenes Crate sind und daher unsere Bibliothek erst einbinden m&#xFC;ssen.
Das ist auch ein Grund warum Integrationstests hier gut aufgehoben sind, sie verwenden unsere Bibliothek genauso wie es ein dritter tun w&#xFC;rde.</p>
<p>F&#xFC;hren wir sie aus:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/you/projects/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> tests::it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

     Running target/lib-c18e7d3494509e74

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">0</span> tests

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">0</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Jetzt haben wir drei Sektionen: unsere vorherigen Tests werden ja immernoch ausgef&#xFC;hrt.</p>
<p>Das ist alles zum <code>tests</code> Verzeichnis.
Das <code>tests</code> Modul brauchen wir hier nicht, da alles mit Tests zu tun hat.</p>
<p>Kommen wir nun zum dritten Teil: Dokumentation.</p>
<h2 id="dokumentationstests"><a name="dokumentationstests" class="plugin-anchor" href="#dokumentationstests"><span class="fa fa-link"></span></a>Dokumentationstests</h2>
<p>Nichts ist besser als Dokumentation mit Beispielen.
Nichts ist bl&#xF6;der als wenn die Beispiele in der Dokumentation nicht funktionieren, zum Beispiel, weil sich die API ver&#xE4;ndert hat, seitdem die Dokumentation geschrieben wurde.
Rust macht damit Schluss, indem es automatisch den Code in der Dokumentation mit ausf&#xFC;hrt.
<em>Allerdings nur bei Bibliothek-Crates, nicht Binary-Crates.</em>
Hier nochmal <code>src/lib.rs</code> mit Beispielen:</p>
<pre><code class="lang-rust">
<span class="hljs-comment">//! The `adder` crate provides functions that add numbers to other numbers.</span>
<span class="hljs-comment">//!</span>
<span class="hljs-comment">//! # Examples</span>
<span class="hljs-comment">//!</span>
<span class="hljs-comment">//! ```</span>
<span class="hljs-comment">//! assert_eq!(4, adder::add_two(2));</span>
<span class="hljs-comment">//! ```</span>

<span class="hljs-comment">/// This function adds two to its argument.</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// # Examples</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// ```</span>
<span class="hljs-comment">/// use adder::add_two;</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// assert_eq!(4, add_two(2));</span>
<span class="hljs-comment">/// ```</span>
<span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add_two</span></span>(a: <span class="hljs-keyword">i32</span>) -&gt; <span class="hljs-keyword">i32</span> {
    a + <span class="hljs-number">2</span>
}

<span class="hljs-preprocessor">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> tests {
    <span class="hljs-keyword">use</span> super::*;

    <span class="hljs-preprocessor">#[test]</span>
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">it_works</span></span>() {
        <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">4</span>, add_two(<span class="hljs-number">2</span>));
    }
}
</code></pre>


<p>Wichtig hier: Moduldokumentation beginnt mit <code>//!</code> und Funktionsdokumentation mit <code>///</code>.
Kommentare die mit <code>//</code> beginnen landen nicht in der Dokumentation.
Rusts Dokumentationswerkzeug unterst&#xFC;tzt Markdown, daher markieren drei Accent grave Zeichen <em>(backticks &quot;`&quot;)</em>
Es ist Konvention eine &#xDC;berschrift <code># Examples</code> <em>(bitte Englisch)</em> zu haben, dem dann die Beispiele folgen.</p>
<p>Noch ein Testlauf:</p>
<pre><code class="lang-bash">$ cargo <span class="hljs-built_in">test</span>
   Compiling adder v0.<span class="hljs-number">0.1</span> (file:///home/steve/tmp/adder)
     Running target/adder-<span class="hljs-number">91</span>b3e234d4ed382a

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> tests::it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

     Running target/lib-c18e7d3494509e74

running <span class="hljs-number">1</span> <span class="hljs-built_in">test</span>
<span class="hljs-built_in">test</span> it_works ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">1</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured

   Doc-tests adder

running <span class="hljs-number">2</span> tests
<span class="hljs-built_in">test</span> add_two_0 ... ok
<span class="hljs-built_in">test</span> _0 ... ok

<span class="hljs-built_in">test</span> result: ok. <span class="hljs-number">2</span> passed; <span class="hljs-number">0</span> failed; <span class="hljs-number">0</span> ignored; <span class="hljs-number">0</span> measured
</code></pre>
<p>Jetzt haben wir alle drei Arten von Tests getestet.
Hier hei&#xDF;t der Dokumentationstest <code>_0</code> und der Funktionstest <code>add_two_0</code>.
Die Zahl wir inkrementiert je mehr Tests dazukommen.</p>
<p>Wir haben noch nicht alles wichtige zu Dokumentationstests hier erw&#xE4;hnt.
F&#xFC;r mehr schau in das <a href="documentation">Dokumentationskapitel</a>.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../book/Der_Stack_Und_Der_Heap.html" class="navigation navigation-prev " aria-label="Previous page: Der Stack und der Heap"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../book/Bedingte_Kompilierung.html" class="navigation navigation-next " aria-label="Next page: Bedingte Kompilierung"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"anchors":{},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
